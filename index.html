<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tic Tac Toe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    :root {
      --bg: #f5f5f5;
      --text: #333;
      --cell-bg: white;
      --hover-bg: #f0f0f0;
      --x-color: #2c3e50;
      --highlight-X: #3498db;
      --button-bg: #3498db;
      --button-text: #fff;
      --o-color: #e74c3c;
    }

    body.dark {
      --bg: #111;
      --text: #f5f5f5;
      --cell-bg: #1e1e1e;
      --hover-bg: #333;
      --x-color: #e1e5eb;
      --highlight-X: #e1e5eb;
      --button-bg: #e1e5eb;
      --button-text: #111;
      --o-color: #e74c3c;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }

    body.dark {
      background-color: #111 !important;
      color: #f5f5f5 !important;
    }

    #game {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 12px;
      margin-top: 40px;
      margin-bottom: 20px;
    }

    .cell {
      background: var(--cell-bg);
      border: 2px solid #ccc;
      border-radius: 12px;
      font-size: 4.2rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      color: var(--x-color);
    }

    .cell:active {
      transform: scale(1.05);
    }

    body.dark .cell {
      background-color: #1e1e1e !important;
      border-color: #444 !important;
    }

    .cell:hover {
      background: var(--hover-bg);
    }

    .X {
      color: var(--x-color);
      text-shadow: 1px 1px 4px #7f8c8d;
    }

    .O {
      color: var(--o-color);
      text-shadow: 1px 1px 4px #ffaaaa;
    }

    .win.X {
      box-shadow: 0 0 20px var(--highlight-X);
    }

    .win.O {
      box-shadow: 0 0 20px var(--o-color);
    }

    #newGameBtn {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--text);
      background: none;
      border: none;
      display: none;
      cursor: pointer;
      margin-bottom: 20px;
    }

    #newGameBtn:hover {
      opacity: 0.8;
      text-decoration: underline;
    }

    #darkToggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: none;
      border: none;
      cursor: pointer;
    }

    #darkToggle svg {
      width: 42px;
      height: 42px;
      fill: var(--text);
    }
  </style>
</head>
<body>

<div id="game"></div>
<button id="newGameBtn" aria-label="New Game">New Game</button>
<button id="darkToggle" aria-label="Toggle theme">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M21.64 13.06A9 9 0 0 1 11 2a9 9 0 1 0 10.64 11.06z"/>
  </svg>
</button>

<script>
  const game = document.getElementById('game');
  const newGameBtn = document.getElementById('newGameBtn');
  const darkToggle = document.getElementById('darkToggle');

  let board;
  let gameActive;
  let currentPlayer;
  let firstPlayer = 'X';

  const combos = [
    [0,1,2], [3,4,5], [6,7,8],
    [0,3,6], [1,4,7], [2,5,8],
    [0,4,8], [2,4,6]
  ];

  function initGame() {
    board = Array(9).fill('');
    gameActive = true;
    currentPlayer = firstPlayer;
    renderBoard();
    newGameBtn.style.display = 'none';
    if (currentPlayer === 'O') {
      setTimeout(botMove, 400);
    }
  }

  function renderBoard(highlight = []) {
    game.innerHTML = '';
    board.forEach((val, i) => {
      const div = document.createElement('div');
      div.className = 'cell';
      if (val) {
        div.textContent = val;
        div.classList.add(val);
        if (highlight.includes(i)) div.classList.add('win', val);
      }
      div.addEventListener('click', () => handleClick(i));
      game.appendChild(div);
    });
  }

  function handleClick(i) {
    if (!gameActive || board[i] || currentPlayer !== 'X') return;
    board[i] = 'X';
    renderBoard();
    const result = checkWinner();
    if (result) return endGame(result.winner, result.combo);
    currentPlayer = 'O';
    setTimeout(botMove, 400);
  }

  function botMove() {
    if (!gameActive) return;
    let move;
    if (Math.random() < 0.1) {
      move = randomMove();
    } else {
      move = bestMove();
    }
    if (move !== undefined) {
      board[move] = 'O';
      renderBoard();
      const result = checkWinner();
      if (result) return endGame(result.winner, result.combo);
    }
    currentPlayer = 'X';
  }

  function randomMove() {
    const empty = board.map((v, i) => v === '' ? i : null).filter(i => i !== null);
    return empty.length ? empty[Math.floor(Math.random() * empty.length)] : null;
  }

  function bestMove() {
    let bestScore = -Infinity;
    let move;
    for (let i = 0; i < board.length; i++) {
      if (board[i] === '') {
        board[i] = 'O';
        let score = minimax(board, 0, false);
        board[i] = '';
        if (score > bestScore) {
          bestScore = score;
          move = i;
        }
      }
    }
    return move;
  }

  const scores = { 'O': 1, 'X': -1, 'tie': 0 };

  function minimax(newBoard, depth, isMaximizing) {
    let result = checkResult(newBoard);
    if (result !== null) return scores[result];

    if (isMaximizing) {
      let best = -Infinity;
      for (let i = 0; i < newBoard.length; i++) {
        if (newBoard[i] === '') {
          newBoard[i] = 'O';
          let score = minimax(newBoard, depth + 1, false);
          newBoard[i] = '';
          best = Math.max(score, best);
        }
      }
      return best;
    } else {
      let best = Infinity;
      for (let i = 0; i < newBoard.length; i++) {
        if (newBoard[i] === '') {
          newBoard[i] = 'X';
          let score = minimax(newBoard, depth + 1, true);
          newBoard[i] = '';
          best = Math.min(score, best);
        }
      }
      return best;
    }
  }

  function checkWinner() {
    for (const [a, b, c] of combos) {
      if (board[a] && board[a] === board[b] && board[a] === board[c]) {
        return { winner: board[a], combo: [a, b, c] };
      }
    }
    if (!board.includes('')) return { winner: 'Draw', combo: [] };
    return null;
  }

  function checkResult(b) {
    for (const [a, b1, c] of combos) {
      if (b[a] && b[a] === b[b1] && b[a] === b[c]) return b[a];
    }
    if (!b.includes('')) return 'tie';
    return null;
  }

  function endGame(winner, combo) {
    gameActive = false;
    renderBoard(combo);
    newGameBtn.style.display = 'inline-block';
  }

  newGameBtn.addEventListener('click', () => {
    firstPlayer = firstPlayer === 'X' ? 'O' : 'X';
    initGame();
  });

  darkToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
  });

  initGame();
</script>

</body>
</html>
